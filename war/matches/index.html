<html>
  <head>
    <title>GGP Apollo Server</title>
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans:bold">
    <link rel="stylesheet" type="text/css" href="/apollo.css" />
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>    
  </head>
  <body>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/ResourceLoader.js'></script>
    <script type="text/javascript" src="/apolloHeader.js"></script>
    
    <div id='header'></div>
    <br>
    <div id='stateInfo'></div>
    <br>
    <div id='recentMatchesInfo'></div>

    <script type='text/javascript'>
      generateHeader(document.getElementById('header'));
      var loginState = ResourceLoader.load_json('/data/login');
      var loginHTML = "";
      if (loginState.loggedIn) {
        if (loginState.nickname.length > 0) {
          loginHTML += "Hello, " + loginState.nickname + "! ";
        } else {
          loginHTML += "Hello! ";
        }
        loginHTML += " You are signed in, but you can <a href=\"" + loginState.logoutURL.replace("/REPLACEME", window.location.pathname) + "\">sign out</a> if you'd like.";
      } else {
        loginHTML += "Sign in using OpenID via ";
        for (var i in loginState.preferredOrder) {
          var providerName = loginState.preferredOrder[i];
          loginHTML += "<a href=\"" + loginState.providers[providerName].replace("/REPLACEME", window.location.pathname) + "\"><img src=\"/static/images/" + providerName + ".png\"></img></a> ";
        }
      }      
      document.getElementById('login_div').innerHTML = loginHTML;
    </script>
    <script type='text/javascript'>
      var serverState = ResourceLoader.load_json('/data/serverState');
      var serverStateHTML = 'Currently on scheduling round ' + serverState.schedulingRound + '.<br>';
      serverStateHTML += 'Consecutive backend errors so far: ' + serverState.backendErrors + '.<br>';
      document.getElementById('stateInfo').innerHTML = serverStateHTML;

      var ongoingMatches = ResourceLoader.load_json('/data/matches/ongoing/set');      
      var recentMatches = ResourceLoader.load_json('/data/matches/recent/');
      recentMatches.reverse();
      var recentMatchesHTML = 'Listing of the ' + recentMatches.length + ' most recently played matches: <ul>';
      for (var i = 0; i < recentMatches.length; i++) {
        var theDate = new Date(recentMatches[i].startTime);
        recentMatchesHTML += '<li>Match started at ';
        recentMatchesHTML += theDate.toLocaleTimeString() + ' on ' + theDate.toLocaleDateString();
        recentMatchesHTML += ' with ' + recentMatches[i].apolloPlayers.length + ' players (';
        for (var j = 0; j < recentMatches[i].apolloPlayers.length; j++) {
          recentMatchesHTML += recentMatches[i].apolloPlayers[j];
          if (j < recentMatches[i].apolloPlayers.length - 1) {
            recentMatchesHTML += ', ';
          }
        }
        recentMatchesHTML += '): <a href="' + recentMatches[i].apolloSpectatorURL + 'viz.html">Spectator View</a>. ';
        if (ongoingMatches.indexOf(recentMatches[i].apolloSpectatorURL) >= 0) {
          recentMatchesHTML += '<b>(Ongoing!)</b>';
        }        
      }
      document.getElementById('recentMatchesInfo').innerHTML = recentMatchesHTML;
    </script>
  </body>  
</html>