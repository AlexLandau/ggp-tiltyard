<html>
  <head>
    <title>GGP.org - Tiltyard Gaming Server</title>
    <meta name="description" content="General game playing is about playing games that you've never seen before. Watch intelligent computers play games against each other here!" />  
    <link rel="shortcut icon" href="http://www.ggp.org/favicon.ico">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans:bold">
    <link rel="stylesheet" type="text/css" href="/tiltyard.css" />
    <link rel="canonical" href="http://tiltyard.ggp.org/players/"/>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/Analytics.js'></script>
    <style>
      /* Huge hack to center things. This is surprisingly hard to do.
       * Credit to: http://brunildo.org/test/shrink_center_4.html
       */
      html, body {
	    margin: 0;
        padding: 0;
      }
      html, body, .swc0, .swc1 {
	    height: 100%;
      }
      .swc0 {
        margin: 0 auto;
        display: table;
      }
      .swc1 {
        display: table-cell;
        vertical-align: middle;
        white-space: nowrap;
      }
      .swc2:after {
        position: absolute;
        height: 0%;
        content: "";
      }
      html {
        position: relative;
      }
      a {
        text-decoration:none;
      }      
    </style>
  </head>
  <body>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/ResourceLoader.js'></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/UserInterface.js'></script>
    
    <div class="swc0"><div class="swc1"><div class="swc2">
      <div id='loginView'>
        <table width=614px>
          <tr>
            <td>
	          <img width=362 height=512 src="/static/images/TiltyardLarge.jpg"></img>
	        </td>
	        <td width=20px></td>
	        <td valign="middle">
	          <center>
	            <a class="hugelink">Register</a>
	            <div style="height: 15px"></div>
	            Register your players to participate in the Tiltyard tournament! Sign in using OpenID.
	            <div style="height: 25px"></div>
	            <div id='loginLogos'></div>
	          </center>
	        </td>
          </tr>
        </table>      
      </div>
      <div id='loggedInView' hidden=true>
        <center>Welcome, <span id='loginStatus'></span>.</center>
        <div id='playerList'></div>
      </div>
    </div><span class="swc3"></span></div></div> 

    <script type='text/javascript'>    
      var loginState = ResourceLoader.load_json('/data/login');
      if (!loginState.loggedIn) {
        var loginLogosDiv = document.getElementById('loginLogos');
        var loginLogosHTML = "";
        for (var i in loginState.preferredOrder) {
          var providerName = loginState.preferredOrder[i];
          loginLogosHTML += "<a rel=\"nofollow\" href=\"" + loginState.providers[providerName].replace("/REPLACEME", window.location.pathname) + "\"><img src=\"/static/images/" + providerName + ".png\"></img></a> ";
        }
        loginLogosDiv.innerHTML = loginLogosHTML;
        return;
      } else {
        document.getElementById('loginView').hidden=true;
        document.getElementById('loggedInView').hidden=false;

        var loginStatusDiv = document.getElementById('loginStatus');
        var loginStatusHTML = "";
        if (loginState.nickname.length > 0) {
          loginStatusHTML += "<b>" + loginState.nickname + "</b>";
        } else {
          loginStatusHTML += "Tiltyard user";
        }
        loginStatusHTML += " <sup><a class=\"darklink\" style='text-decoration:none;' href=\"" + loginState.logoutURL.replace("/REPLACEME", window.location.pathname) + "\">(sign out)</a></sup>";
        loginStatusDiv.innerHTML = loginStatusHTML;
      }
      
      function add_new_player() {
        var theName = window.prompt("What should the player's name be? It can only contain letters, digits, dashes, and underscores. Once chosen, it cannot be changed.", "");
        var thePlayer = {};
        thePlayer.name = theName;
        thePlayer.theURL = "";
        thePlayer.isEnabled = false;
        thePlayer.isPingable = true;
        thePlayer.gdlVersion = "GDLv1";
        thePlayer.visibleEmail = "";
        thePlayer.visibleWebsite = "";
        if (theName.length > 0) {
          var theResponse = JSON.parse(ResourceLoader.post_raw("/data/updatePlayer", JSON.stringify(thePlayer)));
          if (theResponse) {
            window.location.href = '/players/' + theName;
          } else {
            alert("Failed to create player named: " + theName);
          }
        }
      }

      function renderPlayerListEntry(aPlayer, nPlayer) {
        var theHTML = '';
        if (nPlayer % 2 == 0) {
          theHTML += "<tr bgcolor=#F5F5F5>";
        } else {
          theHTML += "<tr bgcolor=#E0E0E0>";
        }
        
        function renderCell(x) {
          if (x) {
            return '<td class="padded">' + x + '</td>';
          } else {
            return '<td></td>';
          }
        }
        
        pingStatusIcon = function(aPlayer) {
          var z = aPlayer.pingStatus;
          if (!aPlayer.isEnabled || z == null) {
            return '<img src="/static/images/StatusGrey.png" title="Player is inactive."></img>';
          }
          if (z == "available") return '<img src="/static/images/StatusGreen.png" title="Player is listed as active, and is currently ready for new matches."></img>';
          if (z == "waiting") return '<img src="/static/images/StatusWhite.png" title="Player was just activated: waiting to get its status..."></img>';
          if (z == "error") return '<img src="/static/images/StatusError.png" title="Player is listed as active, but is being unresponsive, so its current status is unknown."></img>';          
          if (z == "busy") return '<img src="/static/images/StatusOrange.png" title="Player is listed as active, and is currently busy playing a match."></img>';
          return '<img src="/static/images/StatusError.png" title="Player is listed as active, but its current status is unrecognizable: ' + z + '."></img>';
        }
        
        theHTML += renderCell(pingStatusIcon(aPlayer));
        theHTML += renderCell('<a href="/players/' + aPlayer.name + '">' + aPlayer.name + '</a>');
        theHTML += renderCell(aPlayer.visibleEmail);
        theHTML += "<td width=10px></td>";
        
        theHTML += "</tr>";
        return theHTML;
      }
      
      // Returns a positive number if "aPlayer" should appear in the player
      // listing after "bPlayer".
      function playerComesAfter(aPlayer, bPlayer) {
        if (("theURL" in aPlayer) && !("theURL" in bPlayer)) return -1;
        if (!("theURL" in aPlayer) && ("theURL" in bPlayer)) return 1;      
        if (aPlayer.isEnabled && !bPlayer.isEnabled) return -1;
        if (!aPlayer.isEnabled && bPlayer.isEnabled) return 1;
        if (aPlayer.name > bPlayer.name) return 1;
        if (aPlayer.name < bPlayer.name) return -1;
        return 0;
      }

      function drawPlayerList() {
        var thePlayers = ResourceLoader.load_json('/data/players/');
        var thePlayersList = [];
        for (var theName in thePlayers) {
          if ("theURL" in thePlayers[theName]) {
            thePlayersList.push(thePlayers[theName]);
          }
        }
        thePlayersList.sort(playerComesAfter);

        var loginState = ResourceLoader.load_json('/data/login');
        var playerListHTML = '<center>';
        if (loginState.loggedIn) {
          playerListHTML += '<table class="matchlist" cellpadding="5px">';
          playerListHTML += '<tr bgcolor=#E0E0E0><th height=30px colspan=5>Your Players</th></tr>';
          for (var i = 0; i < thePlayersList.length; i++) {
            playerListHTML += renderPlayerListEntry(thePlayersList[i], i);
          }
          playerListHTML += '<tr bgcolor=#F5F5F5><td height=30px colspan=5>';
          if (thePlayersList.length == 0) {
          	playerListHTML += 'Get started by <a rel="nofollow" href="javascript:add_new_player()">adding a player</a>.</td></tr>';
          } else {
          	playerListHTML += 'Or <a rel="nofollow" href="javascript:add_new_player()">add a new player</a>.</td></tr>';
          }
          playerListHTML += '</table>';
        } else {
          playerListHTML += '<i>Sign in to register and configure your players!</i>';
        }
        playerListHTML += '</center>';
        document.getElementById('playerList').innerHTML = playerListHTML;
      }
      
      drawPlayerList();
    </script>
  </body>  
</html>