<html>
  <head>
    <title>GGP Apollo Server</title>
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans:bold">
    <link rel="stylesheet" type="text/css" href="/apollo.css" />
    <script type='text/javascript' src='/_ah/channel/jsapi'></script>    
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/Analytics.js'></script>
  </head>
  <body onload="spectatorView.render()" onresize="spectatorView.render()">
    <script type='text/javascript' src='//www.ggp.org/scripts/common/ResourceLoader.js'></script>
    <script type="text/javascript" src="/apolloHeader.js"></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/compulog.js'></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/AJAXSLT.js'></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/ResourceLoader.js'></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/StateRenderer.js'></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/StateMachine.js'></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/SymbolList.js'></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/SpectatorView.js'></script>
    <script type='text/javascript' src='//matches.ggp.org/matches/channel.js'></script>

    <div id='header'></div>
    <div style="float: left; margin: 0; background-color: #E6E6E6; height: 90%; width: 20%">
      <div id="sidePanel"></div>
    </div>
    <div style="float: left; margin-left: 1%; margin-top: 1%; height: 89%; width:79%;">
      <center style="width: 100%; height: 100%">
        <div id="spectator_div" style="width: 100%; height: 100%"></div>
      </center>
    </div>
    <div id="temp"></div>

    <script type='text/javascript'>
      generateHeader(document.getElementById('header'));
      document.getElementById('navBuffer').innerHTML = '<td style="padding: 0; width: 20%"><table style="border: 0; margin: 0; border-spacing: 0px 0px; width: 100%"><tr><td class="navbarBottomAbrupt" height=10px></td></tr></table></td>' + document.getElementById('navBuffer').innerHTML;

      var apolloMatch = ResourceLoader.load_json('/data/matches/http://matches.ggp.org/matches/' + window.location.pathname.replace("/matches/", ""));

      spectatorView = SpectatorView.construct(apolloMatch.apolloSpectatorURL, document.getElementById('spectator_div'));
      // TODO: Fix the width/height calculation properly.
      spectatorView.getHeight = function () { return document.getElementById("spectator_div").clientHeight * 0.95; };
      spectatorView.getWidth = function () { return document.getElementById("spectator_div").clientWidth * 0.95; };
      //spectatorView.getHeight = function () { return window.innerHeight - 70; };
      //spectatorView.getWidth = function () { return window.innerWidth * 0.79; };      
      spectatorView.render();
      
      var sidePanelHTML = '<br>';
      var spectatorMatch = spectatorView.matchData;
      var theDate = new Date(spectatorMatch.startTime);
      sidePanelHTML += '<b>Game:</b> ' + spectatorMatch.gameName + '<br><br>';
      sidePanelHTML += '<b>Started at:</b> ' + theDate.toLocaleTimeString() + ' on ' + theDate.toLocaleDateString() + '<br><br>';
      sidePanelHTML += '<b>Start clock:</b> ' + spectatorMatch.startClock + '<br>';
      sidePanelHTML += '<b>Play clock:</b> ' + spectatorMatch.playClock + '<br><br>';
      sidePanelHTML += '(<a href="' + apolloMatch.apolloSpectatorURL + 'viz.html">Spectator View</a>)<br><br>';
      sidePanelHTML += 'There are ' + apolloMatch.apolloPlayers.length + ' players: <ol>';
      for (var i = 0; i < apolloMatch.apolloPlayers.length; i++) {
        sidePanelHTML += '<li><b>' + spectatorMatch.gameRoleNames[i] + ':</b> ';        
        sidePanelHTML += '<a href="/players/' + apolloMatch.apolloPlayers[i] + '">' + apolloMatch.apolloPlayers[i] + '</a></li>';
      }
      sidePanelHTML += '</ol>';
      document.getElementById('sidePanel').innerHTML = sidePanelHTML;
    </script>
  </body>  
</html>