<html>
  <head>
    <title>GGP.org - Tiltyard Gaming Server</title>
    <meta name="description" content="General game playing is about playing games that you've never seen before. Watch intelligent computers play games against each other here!" />  
    <link rel="shortcut icon" href="http://www.ggp.org/favicon.ico">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans:bold">
    <link rel="stylesheet" type="text/css" href="/apollo.css" />
    <link rel="canonical" href="http://tiltyard.ggp.org/players/"/>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/Analytics.js'></script>
  </head>
  <body>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/ResourceLoader.js'></script>
    <script type='text/javascript' src='//www.ggp.org/scripts/common/UserInterface.js'></script>
    <script type="text/javascript" src="/apolloHeader.js"></script>
  
    <div id='login'></div>
    <br>
    <center><div id="add_player_promo">You can <a rel="nofollow" href="javascript:add_new_player()">add your player</a> to this list!</div></center>
    <br>
    <div id='playerList'></div>

    <script type='text/javascript'>
      //generateHeader(document.getElementById('header'));
      generateLoginPanel(document.getElementById('login'));
      
      var loginState = ResourceLoader.load_json('/data/login');
      if (!loginState.loggedIn) { document.getElementById("add_player_promo").innerHTML = ""; }

      function add_new_player() {
        var theName = window.prompt("What should the player's name be? It can only contain letters, digits, dashes, and underscores. Once chosen, it cannot be changed.", "");
        var thePlayer = {};
        thePlayer.name = theName;
        thePlayer.theURL = "";
        thePlayer.isEnabled = false;
        thePlayer.gdlVersion = "GDLv1";
        thePlayer.visibleEmail = "";
        if (theName.length > 0) {
          var theResponse = JSON.parse(ResourceLoader.post_raw("/data/updatePlayer", JSON.stringify(thePlayer)));
          if (theResponse) {
            drawPlayerList();
          } else {
            alert("Failed to create player named: " + theName);
          }
        }
      }

      function renderPlayerListEntry(aPlayer, nPlayer) {
        var theHTML = '';
        if (nPlayer % 2 == 0) {
          theHTML += "<tr bgcolor=#F5F5F5>";
        } else {          
          theHTML += "<tr bgcolor=#E0E0E0>";
        }
        
        function renderCell(x) {
          if (x) {
            return '<td class="padded">' + x + '</td>';
          } else {
            return '<td></td>';
          }
        }
        
        pingStatusIcon = function(aPlayer) {
          var z = aPlayer.pingStatus;
          if (!aPlayer.isEnabled || z == null) {
            return '<img src="/static/images/StatusGrey.png" title="Player is inactive."></img>';
          }
          if (z == "available") return '<img src="/static/images/StatusGreen.png" title="Player is listed as active, and is currently ready for new matches."></img>';
          if (z == "waiting") return '<img src="/static/images/StatusWhite.png" title="Player was just activated: waiting to get its status..."></img>';
          if (z == "error") return '<img src="/static/images/StatusError.png" title="Player is listed as active, but is being unresponsive, so its current status is unknown."></img>';          
          if (z == "busy") return '<img src="/static/images/StatusOrange.png" title="Player is listed as active, and is currently busy playing a match."></img>';
          return '<img src="/static/images/StatusError.png" title="Player is listed as active, but its current status is unrecognizable: ' + z + '."></img>';
        }
        
        theHTML += renderCell(pingStatusIcon(aPlayer));
        theHTML += renderCell('<a href="/players/' + aPlayer.name + '">' + aPlayer.name + '</a>');
        theHTML += renderCell(aPlayer.visibleEmail);
        theHTML += renderCell(("theURL" in aPlayer) ? "Yours!" : null);
        theHTML += "<td width=10px></td>";
        
        theHTML += "</tr>";
        return theHTML;
      }
      
      // Returns a positive number if "aPlayer" should appear in the player
      // listing after "bPlayer".
      function playerComesAfter(aPlayer, bPlayer) {
        if (("theURL" in aPlayer) && !("theURL" in bPlayer)) return -1;
        if (!("theURL" in aPlayer) && ("theURL" in bPlayer)) return 1;      
        if (aPlayer.isEnabled && !bPlayer.isEnabled) return -1;
        if (!aPlayer.isEnabled && bPlayer.isEnabled) return 1;
        if (aPlayer.name > bPlayer.name) return 1;
        if (aPlayer.name < bPlayer.name) return -1;
        return 0;
      }

      function drawPlayerList() {
        var thePlayers = ResourceLoader.load_json('/data/players/');
        var thePlayersList = [];
        for (var theName in thePlayers) {
          if ("theURL" in thePlayers[theName]) {
            thePlayersList.push(thePlayers[theName]);
          }
        }
        thePlayersList.sort(playerComesAfter);
        
        var playerListHTML = '<center><table class="matchlist" cellpadding="5px">';
        playerListHTML += '<tr bgcolor=#E0E0E0><th height=30px colspan=5>Your Players</th></tr>';
        for (var i = 0; i < thePlayersList.length; i++) {
          playerListHTML += renderPlayerListEntry(thePlayersList[i], i);
        }
        playerListHTML += '</table></center>';
        document.getElementById('playerList').innerHTML = playerListHTML;
      }
      
      drawPlayerList();
    </script>
  </body>  
</html>